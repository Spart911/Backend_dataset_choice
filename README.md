# FastAPI Backend для управления фотографиями

Этот проект предоставляет бэкенд на основе FastAPI для управления фотографиями. Он позволяет фронтенду:
1. Запрашивать тестовую фотографию с бэкенда.
2. Обрабатывать фотографию, распределяя её по определённым папкам на основе пользовательского ввода.

---

## Возможности
- Получение фотографии и её уникального идентификатора (UID) из основной папки.
- Предоставление фотографий через публичный API.
- Обработка фотографий с распределением их по папкам и удалением из основной папки.

---

## Эндпоинты

### 1. `GET /get-test`
Запрашивает первую доступную фотографию из основной папки.

**Ответ:**
```json
{
  "uid": "example.jpg",
  "photo_url": "/photo/example.jpg"
}
```
- **uid**: Уникальный идентификатор фотографии (имя файла).
- **photo_url**: URL для получения фотографии.

---

### 2. `GET /photo/{uid}`
Предоставляет фотографию по её UID.

**Параметры пути:**
- `uid` (строка): Уникальный идентификатор фотографии.

**Ответ:**
- Возвращает файл фотографии.

**Ошибки:**
- `404 Not Found`: Если фотография не найдена.

---

### 3. `POST /process-test`
Обрабатывает фотографию, распределяя её по папкам на основе пользовательского ввода.

**Тело запроса (Form Data):**
- `uid` (строка, обязательное): Уникальный идентификатор фотографии.
- `target` (строка, обязательное): Список чисел, разделённых запятыми (например, `1,2,3`). Каждое число соответствует папке (0-10).

**Пример:**
```bash
curl -X POST \
     -F "uid=example.jpg" \
     -F "target=1,2,3" \
     http://<server-ip>:8000/process-test
```

**Ответ:**
```json
{
  "status": "success",
  "uid": "example.jpg",
  "distributed_to": [1, 2, 3]
}
```

**Ошибки:**
- `400 Bad Request`: Если числа в target не находятся в диапазоне от 0 до 10.
- `404 Not Found`: Если фотография не найдена в основной папке.

---

## Структура папок

```plaintext
project-root/
├── data/
│   ├── main/           # Основная папка для хранения фотографий
│   ├── targets/        # Папка для распределённых фотографий
│       ├── 0/
│       ├── 1/
│       ├── ...
│       └── 10/
└── main.py             # Приложение FastAPI
```

---

## Настройка и запуск

### 1. Установка зависимостей
```bash
pip install fastapi uvicorn
```

### 2. Локальный запуск
Запустите приложение в режиме разработки:
```bash
uvicorn main:app --reload
```
Приложение будет доступно по адресу [http://127.0.0.1:8000](http://127.0.0.1:8000).

### 3. Запуск в продакшене
Используйте **Gunicorn** с Uvicorn worker:
```bash
gunicorn -w 4 -k uvicorn.workers.UvicornWorker -b 0.0.0.0:8000 main:app
```

---

## Примечания
- Убедитесь, что директории `data/main` и `data/targets` существуют перед запуском сервера.
- Только файлы из папки `main` будут обработаны и предоставлены.

---

## Лицензия
Этот проект лицензирован на условиях MIT License.

